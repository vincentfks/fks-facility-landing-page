# Claude AI - RÃ¨gles de DÃ©veloppement
> Configuration pour le dÃ©veloppement avec Claude - Ã€ placer Ã  la racine du projet

## ğŸ¯ Stack Technique
**Frontend:** React 18+ TypeScript | **Backend:** Node.js 20+ Express TypeScript
**Base de donnÃ©es:** Aucune pour le moment | **Auth:** Aucune pour le moment  | **State:** Aucune pour le moment 

## âš¡ RÃ¨gles Absolues - NON NÃ‰GOCIABLES

### TypeScript
- âŒ **INTERDIT:** Type `any`, fichiers .jsx, composants class
- âœ… **OBLIGATOIRE:** Typage strict, interfaces pour props, .tsx/.ts uniquement

### Architecture
```
Frontend: components/ui â†’ features/[feature]/components â†’ pages
Backend: routes â†’ controllers â†’ services â†’ models
```

### Multi-tenant
```typescript
// ğŸ”’ CRITIQUE: TOUJOURS filtrer par organizationId
await prisma.user.findMany({
  where: { organizationId: req.user.organizationId } // OBLIGATOIRE
});
```

## ğŸ“ Nommage de Fichiers
- Composants React: `UserCard.tsx` (PascalCase)
- Hooks: `useAuth.ts` (camelCase + prÃ©fixe use)
- Services: `user.service.ts` (camelCase + .service)
- Utils: `formatDate.ts` (camelCase)

## âš›ï¸ Composants React - Structure Standard

```typescript
// 1. Imports
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/Button';
import type { User } from '@/types/user';

// 2. Types
interface UserCardProps {
  user: User;
  onEdit?: (id: string) => void;
}

// 3. Composant
export const UserCard = ({ user, onEdit }: UserCardProps) => {
  // 3.1 State hooks
  const [isEditing, setIsEditing] = useState(false);
  
  // 3.2 Custom hooks
  const { currentUser } = useAuth();
  
  // 3.3 Effects
  useEffect(() => { /* ... */ }, [user.id]);
  
  // 3.4 Handlers
  const handleEdit = () => setIsEditing(true);
  
  // 3.5 Early returns
  if (!user) return null;
  
  // 3.6 Render
  return <div>{/* ... */}</div>;
};
```

## ğŸš€ Backend - Structure Standard

```typescript
// Controller: Validation + HTTP
export const userController = {
  create: async (req: Request, res: Response, next: NextFunction) => {
    try {
      const user = await userService.createUser({
        ...req.body,
        organizationId: req.user!.organizationId, // Multi-tenant
      });
      res.status(201).json({ success: true, data: user });
    } catch (error) {
      next(error);
    }
  },
};

// Service: Logique mÃ©tier
export const userService = {
  createUser: async (input: CreateUserInput) => {
    // VÃ©rifications mÃ©tier
    const existing = await prisma.user.findFirst({
      where: { 
        email: input.email,
        organizationId: input.organizationId, // Multi-tenant
      },
    });
    
    if (existing) throw new ApiError(409, 'User exists');
    
    return prisma.user.create({ data: input });
  },
};
```

## ğŸ”’ SÃ©curitÃ© - Checklist

- [ ] **Multi-tenant:** `organizationId` dans TOUTES les requÃªtes DB
- [ ] **Validation:** Zod schemas sur tous les inputs
- [ ] **Auth:** Middleware `authenticate` sur routes protÃ©gÃ©es
- [ ] **Errors:** Classe `ApiError` personnalisÃ©e
- [ ] **Env vars:** Validation avec Zod au dÃ©marrage
- [ ] **CORS:** Origins whitelistÃ©es uniquement
- [ ] **Rate limiting:** Sur endpoints critiques

## ğŸ“ Gestion d'Erreurs

```typescript
// Custom error class
export class ApiError extends Error {
  constructor(
    public statusCode: number,
    public message: string
  ) {
    super(message);
  }
}

// Global error handler
export const errorHandler = (err: Error, req, res, next) => {
  if (err instanceof ApiError) {
    return res.status(err.statusCode).json({
      success: false,
      message: err.message,
    });
  }
  
  console.error('Unhandled error:', err);
  res.status(500).json({ success: false, message: 'Internal error' });
};
```

## ğŸ¨ Imports - Ordre Standard

```typescript
// 1. External
import React, { useState } from 'react';
import { useQuery } from '@tanstack/react-query';

// 2. Internal (alias @/)
import { Button } from '@/components/ui/Button';
import { useAuth } from '@/hooks/useAuth';

// 3. Types
import type { User } from '@/types/user';

// âŒ Ã‰VITER les imports relatifs profonds
// import { X } from '../../../utils/x';
```

## âš¡ Performance

```typescript
// âœ… MÃ©moÃ¯sation
const value = useMemo(() => expensiveCalc(data), [data]);
const handler = useCallback(() => doSomething(), []);

// âœ… Lazy loading
const Dashboard = lazy(() => import('@/pages/Dashboard'));

// âœ… Pagination backend
const users = await prisma.user.findMany({
  where: { organizationId },
  skip: (page - 1) * limit,
  take: limit,
});
```

## ğŸ§ª Tests - Structure

```typescript
describe('UserService', () => {
  describe('createUser', () => {
    it('should create user successfully', async () => {
      // Arrange
      const input = { email: 'test@example.com', ... };
      
      // Act
      const result = await userService.createUser(input);
      
      // Assert
      expect(result).toMatchObject(input);
    });
  });
});
```

## âœ… Pre-Commit Checklist

```bash
# Lancer ces commandes AVANT chaque commit
npm run lint          # âœ… Pas d'erreurs ESLint
npm run type-check    # âœ… Pas d'erreurs TypeScript
npm run test          # âœ… Tests passent
```

- [ ] Pas de `console.log` oubliÃ©s
- [ ] Pas de type `any`
- [ ] organizationId vÃ©rifiÃ© sur requÃªtes DB
- [ ] Variables d'env documentÃ©es si ajoutÃ©es

## ğŸ› Logging

```typescript
// âœ… Structured logging
logger.info({ userId, action: 'login' }, 'User logged in');
logger.error({ err, userId }, 'Failed to create user');

// âŒ Ã‰viter console.log en production
```

## ğŸ“š Documentation

```typescript
// âœ… Documenter les fonctions publiques/complexes
/**
 * Calculates prorated subscription cost
 * @param subscription - Active subscription
 * @param usageData - Usage metrics for period
 * @returns Cost in cents
 */
export const calculateCost = (subscription, usageData): number => {
  // Complex logic explained here
};
```

## ğŸš« INTERDICTIONS

| âŒ NE JAMAIS | âœ… TOUJOURS |
|-------------|-------------|
| Type `any` | Types stricts |
| Logique dans composants React | Hooks/services |
| RequÃªtes sans organizationId | Isolation multi-tenant |
| Default exports (composants) | Named exports |
| Imports relatifs profonds | Alias @/ |
| console.log en prod | Structured logging |
| Passwords en clair | Hashing bcrypt/argon2 |

## ğŸ“ RÃ©fÃ©rences Rapides

**Docs complÃ¨tes:** Voir `.claude-project-config.md`
**Types:** `/src/types/`
**Examples:** `/docs/examples/`

---

**Pour Claude:** Respecte TOUJOURS ces rÃ¨gles. Si tu dÃ©vies, explique pourquoi et propose une alternative conforme aux standards.
