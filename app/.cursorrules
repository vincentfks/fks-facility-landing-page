# Cursor Rules - Standards React/Node.js TypeScript

## ğŸ¯ Vue d'Ensemble

Ce projet suit des standards stricts dÃ©finis dans `.claudeconfig`. 
Consulte ce fichier pour les dÃ©tails complets.

## âš¡ RÃ¨gles Absolues

### TypeScript
- Toujours utiliser TypeScript strict
- JAMAIS de type `any`
- Interfaces pour toutes les props React
- Types explicites pour paramÃ¨tres de fonction

### Architecture

#### Frontend (React)
```
src/
â”œâ”€â”€ components/ui/      # Composants rÃ©utilisables
â”œâ”€â”€ features/[name]/    # Features organisÃ©es par domaine
â”‚   â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ services/
â”‚   â””â”€â”€ types/
â”œâ”€â”€ hooks/              # Hooks globaux
â”œâ”€â”€ pages/              # Pages/Routes
â””â”€â”€ lib/                # Config librairies
```

#### Backend (Node.js)
```
src/
â”œâ”€â”€ routes/         # DÃ©finition endpoints
â”œâ”€â”€ controllers/    # Validation + HTTP responses
â”œâ”€â”€ services/       # Logique mÃ©tier
â”œâ”€â”€ models/         # Prisma/DB models
â””â”€â”€ middleware/     # Auth, validation, errors
```

### Composants React - Structure Standard

```typescript
// 1. Imports
import { useState, useEffect } from 'react';
import { Button } from '@/components/ui/Button';
import type { User } from '@/types/user';

// 2. Types
interface ComponentProps {
  prop: string;
}

// 3. Composant (Named export)
export const ComponentName = ({ prop }: ComponentProps) => {
  // 3.1 State hooks
  const [state, setState] = useState();
  
  // 3.2 Custom hooks
  const { data } = useCustomHook();
  
  // 3.3 Effects
  useEffect(() => {}, []);
  
  // 3.4 Handlers
  const handleClick = () => {};
  
  // 3.5 Early returns
  if (!data) return null;
  
  // 3.6 Render
  return <div></div>;
};
```

### Backend - Structure Standard

```typescript
// routes/resource.routes.ts
router.post('/resource', 
  authenticate,
  validateRequest(createSchema),
  controller.create
);

// controllers/resource.controller.ts
export const resourceController = {
  create: async (req, res, next) => {
    try {
      const result = await resourceService.create({
        ...req.body,
        organizationId: req.user!.organizationId, // Multi-tenant!
      });
      res.status(201).json({ success: true, data: result });
    } catch (error) {
      next(error);
    }
  }
};

// services/resource.service.ts
export const resourceService = {
  create: async (input: CreateInput) => {
    // Logique mÃ©tier ici
    return prisma.resource.create({
      data: input,
    });
  }
};
```

## ğŸ”’ SÃ©curitÃ© Multi-Tenant

**CRITIQUE:** Toujours filtrer par `organizationId` dans TOUTES les requÃªtes DB.

```typescript
// âœ… CORRECT
const user = await prisma.user.findFirst({
  where: {
    id: userId,
    organizationId: req.user!.organizationId, // OBLIGATOIRE
  },
});

// âŒ INTERDIT - Risque de fuite de donnÃ©es
const user = await prisma.user.findFirst({
  where: { id: userId },
});
```

## ğŸ“ Conventions de Nommage

```typescript
// Variables, fonctions: camelCase
const userName = 'John';
const fetchUserData = () => {};

// Constantes: UPPER_SNAKE_CASE
const MAX_RETRY_COUNT = 3;

// Classes, Types, Composants: PascalCase
class UserService {}
interface UserProfile {}
export const UserCard = () => {};

// Fichiers:
// - Composants: UserCard.tsx
// - Hooks: useAuth.ts
// - Services: user.service.ts
// - Utils: formatDate.ts
```

## âš›ï¸ React - Bonnes Pratiques

### MÃ©moÃ¯sation
```typescript
// Calculs coÃ»teux
const value = useMemo(() => expensiveCalc(data), [data]);

// Callbacks passÃ©s en props
const handler = useCallback(() => action(), []);
```

### Gestion Ã‰tat
```typescript
// DonnÃ©es serveur: React Query
const { data, isLoading } = useQuery({
  queryKey: ['users', filters],
  queryFn: () => api.users.list(filters),
});

// Ã‰tat UI global: Zustand
const useStore = create((set) => ({
  count: 0,
  increment: () => set((state) => ({ count: state.count + 1 })),
}));
```

### Performance
```typescript
// Code splitting
const Dashboard = lazy(() => import('./Dashboard'));

// Pagination obligatoire pour listes
const users = await prisma.user.findMany({
  skip: (page - 1) * limit,
  take: limit,
});
```

## ğŸ”§ Backend - Bonnes Pratiques

### Validation
```typescript
// Zod schemas
const createUserSchema = z.object({
  email: z.string().email(),
  name: z.string().min(2),
});

// Middleware
validateRequest(createUserSchema)
```

### Gestion Erreurs
```typescript
// Classe custom
export class ApiError extends Error {
  constructor(
    public statusCode: number,
    public message: string
  ) {
    super(message);
  }
}

// Usage
throw new ApiError(404, 'User not found');
```

### Authentification
```typescript
// Middleware auth
export const authenticate = async (req, res, next) => {
  const token = req.headers.authorization?.replace('Bearer ', '');
  if (!token) throw new ApiError(401, 'Auth required');
  
  const payload = await verifyToken(token);
  req.user = payload;
  next();
};
```

## ğŸ§ª Tests

```typescript
describe('Feature', () => {
  describe('method', () => {
    it('should behavior', () => {
      // Arrange
      const input = {};
      
      // Act
      const result = method(input);
      
      // Assert
      expect(result).toEqual(expected);
    });
  });
});
```

## ğŸš« Interdictions

| âŒ NE JAMAIS | âœ… FAIRE |
|-------------|---------|
| Type `any` | Types stricts |
| Default exports (composants) | Named exports |
| Logique dans composants | Hooks/services |
| RequÃªtes sans organizationId | Isolation multi-tenant |
| console.log en prod | Structured logging |
| Passwords en clair | Hashing bcrypt |

## ğŸ“š Documentation

```typescript
/**
 * [Description courte de la fonction]
 * 
 * @param input - Description du paramÃ¨tre
 * @returns Description du retour
 * @throws {ApiError} Quand erreur
 */
export const functionName = (input: Type): Return => {
  // ImplÃ©mentation
};
```

## âš¡ Checklist Pre-Commit

```bash
npm run lint         # âœ… Pas d'erreurs
npm run type-check   # âœ… Types valides
npm run test         # âœ… Tests passent
```

- [ ] Pas de `console.log`
- [ ] Pas de `any`
- [ ] organizationId prÃ©sent
- [ ] Tests ajoutÃ©s/mis Ã  jour

## ğŸ¯ Quand SuggÃ©rer

### Refactoring
Si tu vois du code qui viole ces rÃ¨gles, propose un refactor:
- SÃ©parer logique/prÃ©sentation
- Ajouter typage
- ImplÃ©menter multi-tenant
- AmÃ©liorer structure

### Performance
SuggÃ¨re optimisations si:
- Composant re-rend trop
- Queries DB lentes (N+1)
- Pas de pagination
- Pas de mÃ©moÃ¯sation

### SÃ©curitÃ©
Flag immÃ©diatement:
- RequÃªtes sans organizationId
- Inputs non validÃ©s
- Secrets en dur
- XSS potentiel

## ğŸ“– Ressources

- Standards complets: `.claudeconfig`
- Config dÃ©taillÃ©e: `.claude-project-config.md`
- Templates: `PROMPT-TEMPLATES.md`

---

**Pour l'AI:** Respecte TOUJOURS ces rÃ¨gles. Si tu dÃ©vies, explique pourquoi.
